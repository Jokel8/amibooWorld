<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Map Renderer</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        #map {
            display: grid;
            gap: 2px;
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
        }
        .tile {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: default;
        }
        .tile-layer {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .walkable {
            cursor: pointer;
        }
        .walkable:hover {
            outline: 2px solid yellow;
        }
        .not-walkable {
            cursor: not-allowed;
        }
        .not-walkable::before {
            content: '✖';
            color: red;
            font-size: 30px;
            position: absolute;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
    async function renderMap() {
        const response = await fetch('getMap.php');
        const mapData = await response.json();
        const mapElement = document.getElementById('map');
        
        // Setze Grid-Eigenschaften
        mapElement.style.gridTemplateColumns = `repeat(${mapData.width}, 50px)`;
        mapElement.style.gridTemplateRows = `repeat(${mapData.height}, 50px)`;

        // Erstelle eine Struktur zum Sammeln von Layern
        const layers = {};

        // Durchlaufe die Karte und erstelle Layers
        mapData.map.forEach((row, y) => {
            row.forEach((tile, x) => {
                const key = `${x}-${y}`;
                if (!layers[key]) {
                    layers[key] = [];
                }
                layers[key].push(tile);
            });
        });

        // Rendere die Layers
        Object.entries(layers).forEach(([key, tileLayers]) => {
            const [x, y] = key.split('-').map(Number);
            const tileContainer = document.createElement('div');
            tileContainer.classList.add('tile');

            tileLayers.forEach((tileData, index) => {
                const tileLayer = document.createElement('div');
                tileLayer.classList.add('tile-layer');
                
                // Farbe basierend auf dem Wert
                const colors = {
                    1: '#90EE90', // hellgrün
                    2: '#87CEFA', // hellblau
                    3: '#DEB887', // sandfarben
                    4: '#4169E1', // königsblau
                    5: '#32CD32'  // limegreen
                };

                tileLayer.style.backgroundColor = colors[tileData.properties.value];
                tileLayer.style.zIndex = index;
                tileLayer.textContent = tileData.properties.value;

                // Cursor und Interaktivität basierend auf Begehbarkeit
                if (tileData.properties.is_walkable) {
                    tileContainer.classList.add('walkable');
                } else {
                    tileContainer.classList.add('not-walkable');
                }

                tileContainer.appendChild(tileLayer);
            });

            mapElement.appendChild(tileContainer);
        });
    }

    // Initiiere Rendering beim Laden der Seite
    renderMap();
    </script>
</body>
</html>